(function($){'use strict';var MoneyQuiz={currentQuestion:0,totalQuestions:0,answers:{},container:null,form:null,init:function(){this.container=$('.money-quiz-container');if(!this.container.length)return;this.form=this.container.find('.money-quiz-form');this.totalQuestions=this.container.find('.money-quiz-question').length;this.bindEvents();this.showQuestion(0);this.updateProgress()},bindEvents:function(){var self=this;this.container.on('click','.quiz-next',function(e){e.preventDefault();self.nextQuestion()});this.container.on('click','.quiz-prev',function(e){e.preventDefault();self.prevQuestion()});this.form.on('submit',function(e){e.preventDefault();self.submitQuiz()});this.container.on('change','.option-input',function(){var questionId=$(this).closest('.money-quiz-question').data('question');self.saveAnswer(questionId);if(window.money_quiz_ajax&&window.money_quiz_ajax.settings.auto_advance){setTimeout(function(){self.nextQuestion()},300)}});$(document).on('keydown',function(e){if(!self.container.is(':visible'))return;if(e.key==='ArrowRight'||e.key==='Enter'){self.nextQuestion()}else if(e.key==='ArrowLeft'){self.prevQuestion()}})},showQuestion:function(index){if(index<0||index>=this.totalQuestions)return;this.currentQuestion=index;this.container.find('.money-quiz-question').removeClass('active');this.container.find('.money-quiz-question').eq(index).addClass('active');this.updateNavigation();this.updateProgress();if(window.money_quiz_ajax&&window.money_quiz_ajax.settings.auto_scroll){$('html, body').animate({scrollTop:this.container.offset().top-100},300)}},nextQuestion:function(){if(!this.validateCurrentQuestion()){this.showError(window.money_quiz_ajax.messages.required);return}if(this.currentQuestion<this.totalQuestions-1){this.showQuestion(this.currentQuestion+1)}},prevQuestion:function(){if(this.currentQuestion>0){this.showQuestion(this.currentQuestion-1)}},validateCurrentQuestion:function(){var currentQ=this.container.find('.money-quiz-question').eq(this.currentQuestion);var checked=currentQ.find('.option-input:checked').length;return checked>0},saveAnswer:function(questionNum){var question=this.container.find('.money-quiz-question').eq(questionNum-1);var questionId=question.find('.option-input').attr('name').match(/\d+/)[0];var answer=question.find('.option-input:checked').val();if(answer){this.answers[questionId]=answer}if(window.money_quiz_ajax&&window.money_quiz_ajax.settings.save_progress){this.saveProgress()}},updateNavigation:function(){var prevBtn=this.container.find('.quiz-prev');var nextBtn=this.container.find('.quiz-next');var submitBtn=this.container.find('.quiz-submit');if(this.currentQuestion===0){prevBtn.hide()}else{prevBtn.show()}if(this.currentQuestion===this.totalQuestions-1){nextBtn.hide();submitBtn.show()}else{nextBtn.show();submitBtn.hide()}},updateProgress:function(){var progress=((this.currentQuestion+1)/this.totalQuestions)*100;this.container.find('.progress-fill').css('width',progress+'%');this.container.find('.current-question').text(this.currentQuestion+1)},submitQuiz:function(){var self=this;if(!this.validateAllQuestions()){this.showError(window.money_quiz_ajax.messages.required);return}this.showLoading();var formData=this.form.serializeArray();$.each(this.answers,function(questionId,answer){formData.push({name:'answers['+questionId+']',value:answer})});$.ajax({url:window.money_quiz_ajax.ajax_url,type:'POST',data:formData,success:function(response){self.hideLoading();if(response.success){self.handleSuccess(response.data)}else{self.showError(response.data.message||window.money_quiz_ajax.messages.error)}},error:function(xhr,status,error){self.hideLoading();self.showError(window.money_quiz_ajax.messages.error);if(window.money_quiz_ajax.settings.debug){console.error('Money Quiz Error:',error)}}})},validateAllQuestions:function(){var valid=true;var self=this;this.container.find('.money-quiz-question').each(function(index){var questionId=$(this).find('.option-input').attr('name').match(/\d+/)[0];if(!self.answers[questionId]){valid=false;return false}});return valid},handleSuccess:function(data){this.form.hide();this.container.find('.money-quiz-progress').hide();if(data.html){this.container.find('.money-quiz-results').html(data.html).show()}else{this.showMessage(data.message||window.money_quiz_ajax.messages.complete)}if(data.redirect_url){setTimeout(function(){window.location.href=data.redirect_url},2000)}$(document).trigger('money-quiz-completed',[data])},saveProgress:function(){var data={action:'money_quiz_save_progress',nonce:window.money_quiz_ajax.nonce,quiz_id:this.form.find('input[name="quiz_id"]').val(),progress:this.answers};$.post(window.money_quiz_ajax.ajax_url,data)},showLoading:function(){this.form.find('.quiz-submit').prop('disabled',true).text(window.money_quiz_ajax.messages.submitting);this.container.append('<div class="money-quiz-loading"></div>')},hideLoading:function(){this.form.find('.quiz-submit').prop('disabled',false).text('Get My Results');this.container.find('.money-quiz-loading').remove()},showError:function(message){var error=$('<div class="money-quiz-error">'+message+'</div>');this.container.prepend(error);setTimeout(function(){error.fadeOut(function(){$(this).remove()})},5000)},showMessage:function(message){var msg=$('<div class="money-quiz-success">'+message+'</div>');this.container.find('.money-quiz-results').html(msg).show()}};$(document).ready(function(){MoneyQuiz.init()});window.MoneyQuiz=MoneyQuiz})(jQuery);